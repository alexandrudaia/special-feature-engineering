import numpy as np
import pandas as pd
import hashlib

def perelman_entropy_feature(df, tau=1.0, bins=256):
    n = df.shape[1]
    data = df.values.astype(np.int8)  # Keep as int8 for memory
    # Hash each row to a fixed-length string
    hashes = np.array([
        hashlib.sha256(row.tobytes()).hexdigest()
        for row in data
    ])
    # Count occurrences
    unique, counts = np.unique(hashes, return_counts=True)
    code_to_prob = dict(zip(unique, counts / len(data)))
    p = np.array([code_to_prob[h] for h in hashes])
    norm_const = (4 * np.pi * tau) ** (n / 2)
    f = -np.log(p * norm_const)
    entropy = f - n
    return entropy
# Assuming df is your DataFrame with 10 int8 columns
entropy_feature = perelman_entropy_feature(df)
df['perelman_entropy'] = entropy_feature

